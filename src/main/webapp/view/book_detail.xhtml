<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:p="http://xmlns.jcp.org/jsf/core">

<h:head>
    <title>#{bookController.detailBook.name}</title>
    <link rel="stylesheet" type="text/css" href="../style/style.css"/>
    <link rel="stylesheet" type="text/css" href="../style/detail_author_style.css"/>
</h:head>

<h:body>

    <script type="text/javascript" >
        function get_hidden_author_id(){
            return document.getElementById('editBookForm:hiddenSelectedAuthorsIdContainer').value;
        }

        function pass_id(i){
            document.getElementById('editBookForm:hiddenSelectedAuthorsIdContainer').value=i;
            document.getElementById('editBookForm:hiddenSelectedAuthorsIdContainer').onchange();
            alert("ddfashfhdfas" + document.getElementById('editBookForm:hiddenSelectedAuthorsIdContainer').value );
        }
    </script>

    <ui:include src="../template/navigate_menu.xhtml" />

    <div class="content_panel">

        <a4j:outputPanel id="bookFullName">
            <h2>Book: #{bookController.detailBook.name}</h2>
        </a4j:outputPanel>

        <div id="undername_line">
        </div>

        <div id="review_container" style="display: inline-block;vertical-align: top;">
        <div id="add_review" class="board_style left margin" style="width: 640px">
            <h:form >
                <h:panelGrid columns="3">
                    <h:outputLabel value="Name:" for="inputReviewName"/>
                    <h:inputText id="inputReviewName" value="#{reviewController.newReview.commenterName}"/>
                    <h:message for="inputReviewName" style="color:red" />

                    <h:outputLabel value="Rating:" for="inputReviewRating"/>
                    <h:inputText id="inputReviewRating" value="#{reviewController.newReview.rating}"/>
                    <div>
                    <h:outputText id="authorAddMessage" value="#{bookController.filterAuthorMessage}" styleClass="validate_message"/>
                    <h:message for="inputReviewRating" style="color:red" />
                    </div>


                    <h:outputLabel value="Comment:"/>
                    <h:inputTextarea id="inputCommentArea" value="#{reviewController.newReview.com}" />
                    <h:message for="inputCommentArea" style="color:red" />

                    <h:commandButton value="Save Record" action="#{reviewController.createReview(bookController.detailBook)}" styleClass="margin"/>
                </h:panelGrid>
            </h:form>
        </div>

        <div id="comments_form" class="margin left" style="clear: left">
            <h:form id="form">
                <h:panelGrid columns="1" style="width: 640px">
                    <a4j:outputPanel id="panel" layout="block">
                        <a4j:repeat value="#{reviewController.getReviews(bookController.detailBook)}" var="review" rows="15" id="repeatComments">
                            <f:facet name="header">
                                <rich:dataScroller for="repeatComments" render="panel" fastStep="1"/>
                            </f:facet>
                            <rich:panel styleClass="panel">
                                <f:facet name="header">
                                    <h:panelGroup>
                                        <h:outputText value="#{review.commenterName}" style="font-weight:bold; margin-left: 4px" />
                                    </h:panelGroup>
                                </f:facet>
                                <f:facet name="header">
                                    <h:panelGroup>
                                    <h:commandLink value="#" style="color: inherit" action="#{reviewController.deleteReview(review.id)}">
                                        X
                                    </h:commandLink>
                                    </h:panelGroup>
                                </f:facet>
                                <h:panelGrid columns="2">
                                    <h:outputText value="Rating:" style="font-weight:bold" />
                                    <h:outputText value="#{review.rating}" />
                                    <h:outputText value="Comment:" style="font-weight:bold" />
                                    <h:outputText value="#{review.com}" />
                                    <h:outputText value="Date:" style="font-weight:bold" />
                                    <h:outputText value="#{review.createDate}" />
                                </h:panelGrid>
                            </rich:panel>
                        </a4j:repeat>
                    </a4j:outputPanel>
                </h:panelGrid>
            </h:form>
        </div>
    </div>

    <div id="book_info" class="board_style margin padding" style="display: inline-block; vertical-align: top;">
        <h:form id="editBookForm">
            <h:panelGrid columns="3" >
                <h:outputText value="Name: " for="updateName"/>
                <h:inputText id="updateName" value="#{bookController.detailBook.name}"/>
                <h:message for="updateName" style="color:red" />

                <h:outputText value="Authors: " for="updateAuthor"/>
                <rich:list id="updateAuthor" value="#{bookController.detailBook.authors}" var="newAuthor">
                    <h:commandLink value="#{newAuthor.fullName()}" actionListener="#{authorController.toDetailPage(newAuthor.id)}" />
                    <h:commandLink actionListener="#{bookController.deleteAuthorFromBook(newAuthor.id)}" value=" X">
                        <a4j:ajax execute="updateAuthor" render="updateAuthor" />
                    </h:commandLink>
                </rich:list>
                <h:message for="updateAuthor" style="color:red" />

                <h:outputText value="Add author: "/>
                <rich:autocomplete value="#{bookController.bookAddAuthorAutocomplete}" id="her" attached="false"
                                   autocompleteMethod="#{bookController.autocompleteAuthor}" var="newAuthor" mode="cachedAjax" fetchValue="#{newAuthor.fullName()}"
                                   layout="list" styleClass="margin left">
                    <a4j:ajax event="selectitem" />
                    <h:outputLabel value="#{newAuthor.fullName()}" style="font-weight:bold" onfocus="pass_id('#{newAuthor.id}')" onclick="pass_id('#{newAuthor.id}')"/>
                </rich:autocomplete>

                <h:commandButton actionListener="#{bookController.addAuthorToBook}" value="Add author" styleClass="margin left" style="display: inline-block">
                    <a4j:ajax execute="updateAuthor" render="updateAuthor" />
                </h:commandButton>

                <h:outputText value="ISBN: " for="updateIsbn"/>
                <h:outputText id="updateIsbn" value="#{bookController.detailBook.isbn}"/>
                <h:message for="updateIsbn" style="color:red" />

                <h:outputText value="Publisher: " for="updatePublisher"/>
                <h:inputText id="updatePublisher" value="#{bookController.detailBook.publisher}"/>
                <h:message for="updatePublisher" style="color:red" />

                <h:outputText value="Year: " for="updateYear"/>
                <h:outputText id="updateYear" value="#{bookController.detailBook.publishYear}"/>
                <h:message for="updateYear" style="color:red" />

                <h:outputText value=""/>

                <a4j:commandButton value="Edit" action="#{bookController.update()}">
                    <a4j:ajax execute="@form bookFullName" render="@form bookFullName" />
                </a4j:commandButton>

                <h:commandButton value="Delete">
                    <rich:componentControl target="popup_delete_book" operation="show" />
                </h:commandButton>
            </h:panelGrid>
            <h:inputText value="#{bookController.detailBookAddAuthorId}" id="hiddenSelectedAuthorsIdContainer" style="display: none">
                <f:ajax event="change" />
            </h:inputText>
        </h:form>
    </div>
    </div>

    <!--popups-->

    <rich:popupPanel id="popup_delete_book" modal="true" autosized="true" resizeable="false" style="width: 300px;height: 200px">
        <f:facet name="header">
            <h:outputText value="Add book" />
        </f:facet>
        <f:facet name="controls">
            <h:outputLink value="#" onclick="#{rich:component('popup_delete_book')}.hide(); return false;" style="color: inherit">
                X
            </h:outputLink>
        </f:facet>

        <div class="center_text">
            <div class="center_text" style="height: 50px;margin-top: 50px">
                <p>Confirm deleting this book</p>
            </div>
            <div class="center_text">
                <h:form style="display:inline-block">
                    <h:commandButton value="YES" action="#{bookController.deleteDetail}" styleClass="margin"/>
                </h:form>

                <h:commandButton value="NO" style="display:inline-block" onclick="#{rich:component('popup_delete_books')}.hide(); return false;" styleClass="margin"/>
            </div>
        </div>

    </rich:popupPanel>
</h:body>
</html>